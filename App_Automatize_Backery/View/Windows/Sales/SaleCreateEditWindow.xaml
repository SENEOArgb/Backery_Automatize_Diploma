<Window x:Class="App_Automatize_Backery.View.Windows.Sales.SaleCreateEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:App_Automatize_Backery.View.Windows.Sales"
        mc:Ignorable="d"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" xmlns:salesvm="clr-namespace:App_Automatize_Backery.ViewModels.SalesVM" d:DataContext="{d:DesignInstance Type=salesvm:SaleCreateEditViewModel}"
            xmlns:helpers="clr-namespace:App_Automatize_Backery.Helper.Converters"
        Title="SaleCreateEditWindow" Height="450" Width="800"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MaterialDesignWindow}">
    <Window.Resources>
        <helpers:TimeSpanToDateTimeConverter x:Key="TimeSpanToDateTimeConverter" />
    </Window.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <!-- Отступ перед DataGrid -->
            <RowDefinition Height="*"/>
            <!-- Список продуктов -->
            <RowDefinition Height="Auto"/>
            <!-- Итоговая стоимость -->
            <RowDefinition Height="Auto"/>
            <!-- Кнопки -->
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <!-- Заголовок -->
        <TextBlock Text="Создание / Редактирование продажи" 
                   FontSize="22" FontWeight="Bold" VerticalAlignment="Top"
                   Foreground="{DynamicResource PrimaryHueMidBrush}" 
                   Grid.ColumnSpan="2" Margin="-10,-24,10,0"/>

        <!-- Тип продажи -->
        <TextBlock Text="Тип продажи:" VerticalAlignment="Top" Margin="0,9,0,0"/>
        <ComboBox ItemsSource="{Binding SaleTypes}" 
                  SelectedItem="{Binding SelectedSaleType}"
                  Style="{StaticResource MaterialDesignComboBox}" 
                  Grid.Column="1" Width="250" Margin="127,4,130,0" Grid.RowSpan="2" VerticalAlignment="Top" />

        <!-- Дата продажи -->
        <TextBlock Text="Дата:" Grid.Row="1" VerticalAlignment="Center" />
        <DatePicker x:Name="selDate" 
            SelectedDate="{Binding SelectedOrderDate, Mode=TwoWay}" 
            Style="{StaticResource MaterialDesignDatePicker}" 
            Grid.Column="1" Grid.Row="1" Width="250" />

        <!-- Время продажи -->
        <TextBlock Text="Время:" Grid.Row="2" VerticalAlignment="Center" />
        <materialDesign:TimePicker x:Name="selTime"
                           Style="{StaticResource MaterialDesignTimePicker}"
                           Grid.Column="1" Grid.Row="2" Width="250">
            <materialDesign:TimePicker.SelectedTime>
                <Binding Path="SelectedOrderTime" Mode="TwoWay">
                    <Binding.StringFormat>HH:mm</Binding.StringFormat>
                </Binding>
            </materialDesign:TimePicker.SelectedTime>
        </materialDesign:TimePicker>

        <!-- Выбор продукта -->
        <TextBlock Text="Выбрать продукт:" Grid.Row="3" VerticalAlignment="Center" />
        <ComboBox ItemsSource="{Binding Products}" 
                  DisplayMemberPath="ProductName"
                  SelectedItem="{Binding SelectedProduct}"
                  Style="{StaticResource MaterialDesignComboBox}"
                  Grid.Column="1" Grid.Row="3" Width="250" />

        <!-- Количество -->
        <TextBlock Text="Количество:" Grid.Row="4" VerticalAlignment="Center" />
        <TextBox Text="{Binding SelectedProductQuantity, UpdateSourceTrigger=PropertyChanged}"
                 Grid.Column="1" Grid.Row="4" 
                 Style="{StaticResource MaterialDesignTextBox}" Width="250" />

        <!-- Таблица продуктов -->
        <DataGrid ItemsSource="{Binding SaleProducts}" AutoGenerateColumns="False"
                  RowHeight="40" AlternatingRowBackground="{DynamicResource MaterialDesignPaper}" 
                  Grid.Row="6" Grid.ColumnSpan="2" Margin="0,10,0,0">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Продукт" Binding="{Binding Product.ProductName}" Width="2*"/>
                <DataGridTextColumn Header="Количество" Binding="{Binding CountProductSale}" Width="1*"/>
                <DataGridTextColumn Header="Стоимость" Binding="{Binding CoastToProduct, StringFormat={}{0:R}}" Width="1*"/>
                <DataGridTemplateColumn Header="Действия" Width="1*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Удалить" Command="{Binding DataContext.RemoveProductCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                    CommandParameter="{Binding}" Style="{StaticResource MaterialDesignFlatButton}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Итоговая стоимость -->
        <StackPanel Orientation="Horizontal" Grid.Row="7" Grid.ColumnSpan="2" Margin="0,10,0,0">
            <TextBlock Text="Итоговая стоимость:" FontWeight="Bold"/>
            <TextBlock Text="{Binding TotalCost, StringFormat=\{0:R\}}" FontSize="16" FontWeight="Bold" Margin="10,0,0,0" />
        </StackPanel>

        <!-- Кнопки -->
        <UniformGrid Columns="2" Grid.Row="8" Grid.ColumnSpan="2" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Добавить продукт" Command="{Binding AddProductCommand}" Margin="0 0 10 0" 
                    Style="{StaticResource MaterialDesignRaisedButton}" />
            <Button Content="Сохранить" Command="{Binding SaveCommand}" 
                    Style="{StaticResource MaterialDesignRaisedButton}" />
        </UniformGrid>
    </Grid>
</Window>
