<UserControl x:Class="App_Automatize_Backery.View.UserControls_Pages_.General_WorkerPages.SupplyRequestsUC"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:App_Automatize_Backery.View.UserControls_Pages_.General_WorkerPages" 
             xmlns:viewmodels="clr-namespace:App_Automatize_Backery.ViewModels" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" d:DataContext="{d:DesignInstance Type=viewmodels:SupplyRequestViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"             Background="{DynamicResource MaterialDesignPaper}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="280"/>
            <!-- Верхняя часть с заявками -->
            <RowDefinition Height="*"/>
            <!-- Нижняя часть для UserControl -->
        </Grid.RowDefinitions>

        <!-- Список заявок -->
        <StackPanel Margin="20" Grid.Row="0">
            <TextBlock HorizontalAlignment="Left" Text="Список заявок" FontSize="20" FontWeight="Bold" Margin="10,5,0,10"/>
            <Button Content="Создать заявку" Command="{Binding CreateSupplyRequestCommand}" 
                    Visibility="{Binding ManagerVisibility}" HorizontalAlignment="Center" 
                    VerticalAlignment="Top" Margin="10,-35,5,10" Height="35"/>

            <DataGrid x:Name="supplyRequest" Height="260" ItemsSource="{Binding SupplyRequests}" HeadersVisibility="All"
                      SelectedItem="{Binding SelectedRequest, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                      AutoGenerateColumns="False" IsReadOnly="True" Style="{StaticResource MaterialDesignDataGrid}"
                      ScrollViewer.VerticalScrollBarVisibility="Auto">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Дата" Binding="{Binding SupplyRequestDate, StringFormat='dd.MM.yyyy HH:mm'}" Width="Auto"/>
                    <DataGridTextColumn Header="Статус" Binding="{Binding Status.StatusName}" Width="Auto"/>
                    <DataGridTextColumn Header="Цена" Binding="{Binding TotalSalary,  StringFormat={}{0} руб.}" Width="Auto"/>
                    <!-- Кнопка "Просмотреть" -->
                    <DataGridTemplateColumn Header="Просмотреть" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Просмотреть"
                                        Command="{Binding DataContext.ViewSupplyRequestMaterialsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}"
                                        Background="DodgerBlue" 
                                        Foreground="White"
                                        Padding="5"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Редактировать" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Редактировать"
                    Command="{Binding DataContext.EditSupplyRequestCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding}"
                    Background="Orange" 
                    Foreground="White"
                    Padding="5"
                    Visibility="{Binding DataContext.ManagerVisibility, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                    IsEnabled="{Binding StatusId, Converter={StaticResource StatusToEnabledConverter}}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Действия">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="Принять" 
                        Command="{Binding DataContext.AcceptRequestCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        CommandParameter="{Binding}" 
                        Visibility="{Binding DataContext.AcceptButtonVisibility, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                        IsEnabled="{Binding StatusId, Converter={StaticResource StatusToEnabledConverter}}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Кнопка "Удалить" -->
                    <DataGridTemplateColumn Header="Удалить" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Удалить" 
                    Command="{Binding DataContext.DeleteSupplyRequestCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding}" 
                    Background="Red" 
                    Foreground="White"
                    Padding="5"
                    Visibility="{Binding DataContext.ManagerVisibility, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                    IsEnabled="{Binding StatusId, Converter={StaticResource StatusToEnabledConverter}}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>

        <Border/>

        <!-- ContentControl для отображения вложенного UserControl -->
        <ContentControl Content="{Binding CurrentContent}" Margin="0,0,20,-90" Grid.Row="1"/>
    </Grid>
</UserControl>
