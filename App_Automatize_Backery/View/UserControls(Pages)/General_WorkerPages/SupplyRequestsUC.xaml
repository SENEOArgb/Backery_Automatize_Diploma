<UserControl x:Class="App_Automatize_Backery.View.UserControls_Pages_.General_WorkerPages.SupplyRequestsUC"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:App_Automatize_Backery.View.UserControls_Pages_.General_WorkerPages" 
             xmlns:viewmodels="clr-namespace:App_Automatize_Backery.ViewModels" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" d:DataContext="{d:DesignInstance Type=viewmodels:SupplyRequestViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"             Background="{DynamicResource MaterialDesignPaper}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и кнопка создания заявки -->
        <StackPanel Grid.Row="0" Margin="20">
            <TextBlock HorizontalAlignment="Center" Text="Список заявок" FontSize="24" FontWeight="Bold" Margin="10,-50,0,10"/>
            <Button Command="{Binding CreateSupplyRequestCommand}" 
                    Visibility="{Binding ManagerVisibility}" HorizontalAlignment="Center" 
                    VerticalAlignment="Top" Margin="10,0,5,10" Height="35"
                    Style="{StaticResource MaterialDesignFlatButton}">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="PlusCircleOutline" Margin="0,0,6,0"/>
                    <TextBlock Text="Создать" FontWeight="SemiBold"/>
                </StackPanel>
            </Button>

            <!-- Таблица заявок -->
            <DataGrid x:Name="supplyRequest" Height="300" ItemsSource="{Binding SupplyRequests}" 
                      SelectedItem="{Binding SelectedRequest, Mode=TwoWay}" CanUserResizeRows="False" CanUserResizeColumns="False"
                      AutoGenerateColumns="False" IsReadOnly="True" MaxHeight="350"
                      Style="{StaticResource MaterialDesignDataGrid}" ScrollViewer.VerticalScrollBarVisibility="Auto">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Дата" Binding="{Binding SupplyRequestDate, StringFormat='dd.MM.yyyy HH:mm'}" Width="Auto"/>
                    <DataGridTextColumn Header="Статус" Binding="{Binding Status.StatusName}" Width="Auto"/>
                    <DataGridTextColumn Header="Цена" Binding="{Binding TotalSalary, StringFormat={}{0} руб.}" Width="Auto"/>

                    <!-- Кнопка "Просмотреть" -->
                    <DataGridTemplateColumn Header="                                Действия" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Width="Auto" Orientation="Horizontal">
                                    <Button Content="Просмотреть" 
                                        Command="{Binding DataContext.ViewSupplyRequestMaterialsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" 
                                        Background="DarkBlue" 
                                        Foreground="White" Padding="5" />
                                    <Button Content="Редактировать"
                                        Command="{Binding DataContext.EditSupplyRequestCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" Margin="40 0 0 0"
                                        Background="Orange" Foreground="White" Padding="5"
                                        Visibility="{Binding DataContext.ManagerVisibility, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                    <Button Content="Отменить" 
                                        Command="{Binding DataContext.DeleteSupplyRequestCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" Margin="40 0 0 0"
                                        Background="Red" Foreground="White" Padding="5"
                                        Visibility="{Binding DataContext.ManagerVisibility, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                    <Button Content="Принять" 
                                        Command="{Binding DataContext.AcceptRequestCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" Margin="40 0 0 0"
                                        Visibility="{Binding DataContext.AcceptButtonVisibility, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        IsEnabled="{Binding StatusId, Converter={StaticResource StatusToEnabledConverter}}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>

        <Separator Margin="0 420 0 0"/>

        <ContentControl Content="{Binding CurrentContent}" Margin="0,0,20,0" Grid.Row="1"/>
    </Grid>
</UserControl>
